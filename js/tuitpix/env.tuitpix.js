/*
 * env.tuitpix.js
 * Copyright (c) 2011 Daniel Rodriguez, dan@tuitpix.com
 * MIT License [http://www.opensource.org/licenses/mit-license.php]
 */
tuitpix.encodeToHex=function(b){var d="",e=b.length,c=0,a;while(c<e){a=b.charCodeAt(c++).toString(16);while(a.length<3)a="0"+a;d+=a}return d};tuitpix.decodeFromHex=function(d){var b="",a=d.length,c;while(a>=0){c=a-3;b=String.fromCharCode("0x"+d.substring(c,a))+b;a=c}return b};tuitpix.widgets={submenu:false,sublogin:false,help:false};$("#menu").hover(function(){!tuitpix.widgets.submenu&&$("#menu").css({backgroundPosition:"0px 0px"})},function(){!tuitpix.widgets.submenu&&$("#menu").css({backgroundPosition:"0px -49px"})});$("#menu").click(function(){$("#menu").css({backgroundPosition:"-49px 0px"});$("#submenu").fadeIn(140);tuitpix.widgets.submenu=true});$("body").mouseup(function(){if(tuitpix.widgets.submenu){$("#menu").css({backgroundPosition:"0px -49px"});$("#submenu").fadeOut(140);tuitpix.widgets.submenu=false}if(tuitpix.widgets.help){if(tuitpix._help.STOP)tuitpix._help.STOP=0;$("#help").fadeOut(140);tuitpix.widgets.help=false;tuitpix._help.current=false}!tuitpix.USER&&tuitpix.help("tw_login")});$("#img_totw").hover(function(){$("#img_totw").css({backgroundPosition:"-42px -245px"})},function(){$("#img_totw").css({backgroundPosition:"0px -245px"})});tuitpix._loading={current:0,map:["7px 7px","0px 14px","-7px 7px","0px 0px"]};tuitpix.loading=function(){var a=this,b=$("#loading");b.animate({backgroundPosition:"0px 0px"},0);b.css("display")!=="none"&&b.animate({backgroundPosition:a._loading.map[a._loading.current]},0,function(){setTimeout(function(){tuitpix.loading()},140)});a._loading.current=a._loading.map.length==a._loading.current+1?0:a._loading.current+1};tuitpix.loading();tuitpix._help={current:"",renable:0,STOP:0,eng:{},esp:{}};tuitpix.help=function(b){var h="tw_login",g="#help",f="#help_text",e="default",a=this,c=b||e;if(a._help.current==c||a._help.STOP)return;else a._help.current=c;$(f).html("");if(a._help[a.LANG][c])$(f).html(a._help[a.LANG][c]);else $.get("help/"+a.LANG+"_"+a.location+"_"+c+".html",function(a){if(tuitpix.USER)a=a.replace(/\[user\]/g,tuitpix.USER);$(f).html(a);tuitpix._help[tuitpix.LANG][c]=a});if(c=="save"||b==e){a._help.STOP=1;setTimeout("tuitpix._help.STOP = 0",7e3)}if(b&&b!=e){if(b=="save"||b=="load")b="img_save";var i=(document.body.offsetWidth||document.documentElement.offsetWidth||window.innerWidth)/2,d=$("#"+b).offset();$(g).css({left:Math.abs(d.left/7)*7+(d.left>i?56:-210)+(b==h?-21:0),top:d.top+(b==h?7:0),width:"203px",height:"auto",textAlign:"center"})}else{var d=$("#avatar").offset()?$("#avatar").offset():$("#maker").offset();$(g).css({left:d.left,top:d.top,width:"315px",height:"315px",textAlign:"justify"})}$(g).fadeIn(140);a.widgets.help=true};$(" #img_gen, #img_hair, #img_beard, #img_wear, #img_addon, #img_down, #img_save, #img_boy, #img_brsh, #img_ersr, #controls, #avatar, #maker, #header h1, #tw_save, #tw_login, #tw_logout ").mouseover(function(){tuitpix.help(this.id)});$("#flag_vzla").click(function(){if(tuitpix.LANG=="esp")return;$.get("s/lang.php",{lang:"esp"});$("#flag_engl").attr("class","");$("#flag_vzla").attr("class","active");tuitpix.LANG="esp"});$("#flag_engl").click(function(){if(tuitpix.LANG=="eng")return;$.get("s/lang.php",{lang:"eng"});$("#flag_vzla").attr("class","");$("#flag_engl").attr("class","active");tuitpix.LANG="eng"});$("#tw_login").click(function(){window.location="?authorize=1&amp;force_write=1"});$("#tw_logout").click(function(){window.location="?wipe=1"});tuitpix.LOAD=function(c,e){var a=this;if(c){if(a.location=="index"){a.looking=parseInt(c[1])?true:false;var d=parseInt(c[2]);for(s in a.set){a.conf[s]=0;if(c[s]===undefined)continue;if(s=="gen"){var b=a.decodeFromHex(c[s]);if(b.length<7)b="[]";a.set[s][d][0]=jsonParse(b)}else{var b=a.decodeFromHex(c[s]);if(b.length<7)b="[]";b=jsonParse(b);a.set[s].unshift(["saved",[[b],[b]]])}}a.Set();a.redraw();d&&a.setNext()}a.help("load");a.LOAD(0,1)}else if(e)for(s in a.set){if(s=="gen")continue;$.ajax({type:"POST",url:"s/load.php",data:"active="+s,success:function(b){var b=b?$.parseJSON(b)[0]:{};for(s in tuitpix.set){if(!b[s])continue;var a=tuitpix.decodeFromHex(b[s]);if(a.length<7)a="[]";a=jsonParse(a);tuitpix.set[s].push(["loaded",[[a],[a]]])}}})}};tuitpix.SAVE=function(l){var f="\r\n--",e=this,g=new XMLHttpRequest,k=g.upload,m=e,d="multipartformboundary"+ +new Date;k.addEventListener("load",function(a){if(!a)return;tuitpix.help("save",1)},false);g.open("POST","s/save.php",true);g.setRequestHeader("content-type","multipart/form-data; boundary="+d);builder="--"+d+'\r\nContent-Disposition: form-data; name="image"; filename="tuitpix.png"\r\nContent-Type: image/png\r\n\r\n';builder+=e.canv.toDataURL("image/png").split(",")[1];builder+=f+d+'\r\nContent-Disposition: form-data; name="twitter"\r\n\r\n'+(l?"1":"0");builder+=f+d+'\r\nContent-Disposition: form-data; name="looking"\r\n\r\n'+(e.looking?"1":"0");var i=e.set,h=e.conf,j=0;for(c in i){var a="[",b=null;if(c=="gen"){builder+=f+d+'\r\nContent-Disposition: form-data; name="sex"\r\n\r\n'+h[c];j=h[c];b=i[c][j][0]}else b=i[c][e.cats[c]][1][j][h[c]];if(b.length)for(o in b){if(!b[o][0])continue;a+='["'+b[o][0].toUpperCase()+'",[';for(oo in b[o][1]){a+="[";for(ooo in b[o][1][oo])a+=b[o][1][oo][ooo]+",";a=a.substring(0,a.length-1);a+="],"}a=a.substring(0,a.length-1);a+="]],"}else a+=" ";a=a.substring(0,a.length-1);a+="]";builder+=f+d+'\r\nContent-Disposition: form-data; name="'+c+'"\r\n\r\n'+e.encodeToHex(a)}builder+=f+d+'\r\nContent-Disposition: form-data; name="img"\r\n\r\n'+e.canv.toDataURL();builder+=f+d+"--\r\n";g.send(builder)};